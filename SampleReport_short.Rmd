---
title: "VectorSurv Sample Report using R"
date: "October 25, 2023"
author: "Prepared by Christina and Olivia"
geometry: left=1in,right=1in,top=1in,bottom=1in
---
```{r, include=FALSE}
knitr::opts_chunk$set(
  message=FALSE, warning=FALSE, results='asis')

```

```{r chunk-2, include=FALSE}
source("VS_functions.R")
```


```{r retrieve-data, include=FALSE}
## Retrieve your data from the VectorSurv API
##Uncomment the code below and and run it once. Before moving on, recomment the code. This will prevent R from retreiving your data each time you knit your file. 

# collections = getArthroCollections(2018,2023)
# pools = getPools(2022,2023)

# write.csv2(collections, file="collections_18_23.csv")
#write.csv2(pools, file="pools_22_23.csv")
```

```{r chunk-4, echo=FALSE}
##Read your csvs into your R workspace to continue working with them
collections = read.csv("collections_18_23.csv", sep = ",")
pools = read.csv("pools_18_23.csv", sep=",")
# 
# #the following are options for filtering your data
# collections = collections %>% 
#   filter(agency_code == "SAYO")
```

I can include any text relevant to the report, such as a quick summary of what's happening at this point in the season and I can **bold anything that is important** or maybe *italicize it*. This is using the basics of [Markdown](https://www.markdownguide.org/cheat-sheet/). I can also create specific sections, such as Trapping effort, Abundance, West Nile Activity, etc, and can change the header size.

## Abundance

I can include text anywhere outside of the code chunks and the text will show up in my final file. 


```{r echo=FALSE}
abundance2023 <- getAbundance(collections,
                    interval = "Week",
                    species_list = c("Cx tarsalis", "Cx pipiens"),
                    trap_list = "CO2",
                    species_seperate = FALSE) 


abundance2023 %>% 
  filter(EPIYEAR=="2023") %>%
  filter(Week>"30") %>%
  kbl(col.names = c("Disease Year", "Week", "Count","Trap Events", "Mosquitoes per trap night")) %>%
  kable_styling(bootstrap_options = "striped",
                              font_size = 14, 
                html_font = "Cambria", full_width = F)%>%  
  footnote(general = "Table X: Combined biweekly Abundance Calculation for Cx. tarsalis, pipiens in CO2 traps", general_title = "")

```



```{r echo=FALSE, fig.width=10}

AbAnOut = getAbundanceAnomaly(collections,
                              interval = "Week",
                              species_list = c("Cx tarsalis", "Cx pipiens"),
                              target_year = 2023,
                              species_seperate = TRUE) #species_seperate set to true will allow for us to facet wrap along species


AbAnOut_L = ProcessAbunAnom(AbAnOut)

#Example using ggplot
AbAnOut_L %>%  filter(Abundance_Type %in% c("2023_Abundance",
                                            "Five_Year_Avg"))%>%  
  ggplot(aes(x=Week,
             y= Abundance_Calculation,
             color = Abundance_Type)) +
  geom_point()+ 
  geom_line() + 
  facet_wrap(~species_display_name)+
  labs(title="2023 Abundance Anomaly",y = "")

```


## Pools


